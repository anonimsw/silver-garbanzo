<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Форма заказа</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
        .focus-ring:focus {
    outline: none;
    box-shadow: 0 0 0 2px #2563eb;
}

.payment-type img {
    max-height: 40px;
}

.payment-type.active {
    border: 2px solid #2563eb;
    background-color: #eff6ff;
}

.payment-type:hover {
    background-color: #f3f4f6;
    transition: background-color 0.2s ease-in-out;
}
       </style>
    </head>
    <body class="bg-gray-100 font-sans">
        <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
            <form id="orderForm"
                class="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                <!-- Клиент -->
                <div class="mb-6">
                    <div class="border-b pb-2 mb-4">
                        <h2
                            class="text-xl font-semibold text-gray-800">Клиент</h2>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <input type="text" id="client_name"
                                name="client_name" placeholder="Имя клиента"
                                class="w-full p-2 border rounded-md focus-ring"
                                aria-label="Имя клиента">
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <input type="tel" name="phone_number_1"
                                placeholder="Номер 1" value="+998"
                                class="w-full p-2 border rounded-md focus-ring"
                                aria-label="Номер телефона 1">
                            <input type="tel" name="phone_number_2"
                                placeholder="Номер 2" value="+998"
                                class="w-full p-2 border rounded-md focus-ring"
                                aria-label="Номер телефона 2">
                        </div>
                    </div>
                </div>

                <!-- Тип заказа -->
                <div class="mb-6">
                    <div class="border-b pb-2 mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Тип
                            заказа</h2>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <select name="delivery_type" id="delivery_type"
                                class="w-full p-2 border rounded-md focus-ring"
                                aria-label="Тип доставки">
                                <option value="Доставка">Доставка</option>
                                <option value="Самовывоз">Самовывоз</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Дополнительные данные -->
                <div class="mb-6" id="additional_data">
                    <div class="border-b pb-2 mb-4">
                        <h2
                            class="text-xl font-semibold text-gray-800">Дополнительные
                            данные</h2>
                    </div>
                    <div id="delivery_fields" class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <div class="col-span-2">
                                <label for="to_address"
                                    class="block text-sm font-medium text-gray-700">Адрес
                                    <span class="text-red-500">*</span></label>
                                <input type="text" id="to_address"
                                    name="to_address" placeholder="Адрес..."
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Адрес доставки" required>
                            </div>
                            <div>
                                <label for="accommodation"
                                    class="block text-sm font-medium text-gray-700">Дом</label>
                                <input type="text" id="accommodation"
                                    name="accommodation" placeholder="Дом"
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Номер дома">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <div>
                                <label for="apartment"
                                    class="block text-sm font-medium text-gray-700">Квартира</label>
                                <input type="text" id="apartment"
                                    name="apartment" placeholder="Квартира"
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Номер квартиры">
                            </div>
                            <div>
                                <label for="floor"
                                    class="block text-sm font-medium text-gray-700">Этаж</label>
                                <input type="number" id="floor" name="floor"
                                    placeholder="Этаж"
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Этаж">
                            </div>
                            <div>
                                <label for="building"
                                    class="block text-sm font-medium text-gray-700">Подъезд</label>
                                <input type="text" id="building" name="building"
                                    placeholder="Подъезд"
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Подъезд">
                            </div>
                        </div>
                    </div>
                    <div id="pickup_fields" class="space-y-4 hidden">
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label for="branch_pickup"
                                    class="block text-sm font-medium text-gray-700">Филиал
                                    <span class="text-red-500">*</span></label>
                                <select name="branch" id="branch_pickup"
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Филиал" required>
                                    <option value>Выберите филиал</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Продукты -->
                <div class="mb-6">
                    <div class="border-b pb-2 mb-4">
                        <h2
                            class="text-xl font-semibold text-gray-800">Продукты</h2>
                    </div>
                    <div id="products_container" class="space-y-6">
                        <div
                            class="flex justify-between gap-4 product-row bg-gray-50 p-4 rounded-md shadow-sm">
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700">Название</label>
                                <input type="text" name="products[0][name]"
                                    value="Пакет"
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Название продукта">
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700">Количество</label>
                                <div
                                    class="flex items-center border rounded-md">
                                    <button type="button"
                                        class="p-2 text-blue-600 decrease-quantity"
                                        aria-label="Уменьшить количество">
                                        <svg class="w-5 h-5" fill="none"
                                            viewBox="0 0 24 24"><path
                                                stroke="currentColor"
                                                stroke-width="2"
                                                d="M18 13H6"></path></svg>
                                    </button>
                                    <input type="number"
                                        name="products[0][quantity]" value="1"
                                        min="1"
                                        class="w-full p-2 border-none focus-ring text-center"
                                        aria-label="Количество">
                                    <button type="button"
                                        class="p-2 text-blue-600 increase-quantity"
                                        aria-label="Увеличить количество">
                                        <svg class="w-5 h-5" fill="none"
                                            viewBox="0 0 24 24"><path
                                                stroke="currentColor"
                                                stroke-width="2"
                                                d="M18 13h-5m0 0H6m7 0V6m0 7v5"></path></svg>
                                    </button>
                                </div>
                            </div>
                            <div class>
                                <label
                                    class="block text-sm font-medium text-gray-700">Описание</label>
                                <input type="text"
                                    name="products[0][description]"
                                    placeholder="Описание"
                                    class=" p-2 border rounded-md focus-ring"
                                    aria-label="Описание продукта">
                            </div>
                            <div class="items-end justify-center">
                                <label
                                    class="block text-sm font-medium text-red-500">Удалить</label>
                                <button type="button "
                                    class="flex 
                                    alig px-4 py-2 border border-red-500 text-red-500 rounded-md hover:bg-red-50 focus-ring transition duration-150 ease-in-out">
                                    <svg class="w-5 h-5" fill="none"
                                        viewBox="0 0 24 24"><path
                                            stroke="currentColor"
                                            stroke-width="2"
                                            d="M6 6l12 12m0-12L6 18"></path></svg></button>
                            </div>
                        </div>
                        <!-- Второй продукт -->
                        <div
                            class="flex justify-between gap-4 product-row bg-gray-50 p-4 rounded-md shadow-sm">
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700">Название</label>
                                <input type="text" name="products[0][name]"
                                    value="Пакет"
                                    class="w-full p-2 border rounded-md focus-ring"
                                    aria-label="Название продукта">
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700">Количество</label>
                                <div
                                    class="flex items-center border rounded-md">
                                    <button type="button"
                                        class="p-2 text-blue-600 decrease-quantity"
                                        aria-label="Уменьшить количество">
                                        <svg class="w-5 h-5" fill="none"
                                            viewBox="0 0 24 24"><path
                                                stroke="currentColor"
                                                stroke-width="2"
                                                d="M18 13H6"></path></svg>
                                    </button>
                                    <input type="number"
                                        name="products[0][quantity]" value="1"
                                        min="1"
                                        class="w-full p-2 border-none focus-ring text-center"
                                        aria-label="Количество">
                                    <button type="button"
                                        class="p-2 text-blue-600 increase-quantity"
                                        aria-label="Увеличить количество">
                                        <svg class="w-5 h-5" fill="none"
                                            viewBox="0 0 24 24"><path
                                                stroke="currentColor"
                                                stroke-width="2"
                                                d="M18 13h-5m0 0H6m7 0V6m0 7v5"></path></svg>
                                    </button>
                                </div>
                            </div>
                            <div class>
                                <label
                                    class="block text-sm font-medium text-gray-700">Описание</label>
                                <input type="text"
                                    name="products[0][description]"
                                    placeholder="Описание"
                                    class=" p-2 border rounded-md focus-ring"
                                    aria-label="Описание продукта">
                            </div>
                            <div class="items-end justify-center">
                                <label
                                    class="block text-sm font-medium text-red-500">Удалить</label>
                                <button type="button "
                                    class="flex 
                                    alig px-4 py-2 border border-red-500 text-red-500 rounded-md hover:bg-red-50 focus-ring transition duration-150 ease-in-out">
                                    <svg class="w-5 h-5" fill="none"
                                        viewBox="0 0 24 24"><path
                                            stroke="currentColor"
                                            stroke-width="2"
                                            d="M6 6l12 12m0-12L6 18"></path></svg></button>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="addProductBtn"
                        class="mt-4 inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus-ring transition duration-150 ease-in-out">
                        <svg class="w-5 h-5 mr-2" fill="none"
                            viewBox="0 0 24 24"><path stroke="currentColor"
                                stroke-width="2"
                                d="M18 13h-5m0 0H6m7 0V6m0 7v5"></path></svg>
                        Добавить продукт
                    </button>
                </div>

                <!-- Комментарии и оплата -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Комментарии -->
                    <div class="mb-6">
                        <div class="border-b pb-2 mb-4">
                            <h2
                                class="text-xl font-semibold text-gray-800">Комментарии
                                к заказу</h2>
                        </div>
                        <textarea name="description" id="description"
                            placeholder="Оставьте комментарий для заказа"
                            class="w-full p-2 border rounded-md focus-ring h-32"
                            aria-label="Комментарий к заказу"></textarea>
                    </div>
                    <!-- Оплата -->
                    <div class="mb-6">
                        <div class="border-b pb-2 mb-4">
                            <h2
                                class="text-xl font-semibold text-gray-800">Оплата</h2>
                        </div>
                        <div class="flex space-x-4 overflow-x-auto pb-2">
                            <div
                                class="payment-type p-4 border rounded-md cursor-pointer active"><img
                                    src="https://cdn.delever.uz/delever/be4916a9-63e6-485a-952c-0574d0945fca"
                                    alt="Наличные"></div>
                            <input type="radio" name="payment_type"
                                value="Наличные" class="hidden" checked>
                            <div
                                class="payment-type p-4 border rounded-md cursor-pointer"><img
                                    src="https://cdn.delever.uz/delever/8d1dd525-173c-47ec-bf7a-c8cd4e129604"
                                    alt="Terminal"></div>
                            <input type="radio" name="payment_type"
                                value="Terminal" class="hidden">
                        </div>
                        <div class="grid grid-cols-1 gap-4 mt-4">
                            <div>
                                <p class="text-sm text-gray-500">Сумма
                                    заказа</p>
                                <p class="text-base font-semibold">2 000 UZS</p>
                                <input type="hidden" name="order_amount"
                                    value="2 000 UZS">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Кнопки -->
                <div class="flex justify-end space-x-4">
                    <button type="button"
                        class="px-4 py-2 border border-red-500 text-red-500 rounded-md hover:bg-red-50 focus-ring transition duration-150 ease-in-out">Отменить</button>
                    <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus-ring transition duration-150 ease-in-out">Отправить</button>
                </div>
            </form>
        </div>
        <script>

const BOT_TOKEN = '8458915257:AAG7Nt6t-2zbFC3M6s-LbZKB7CvRCklQoeo';
const CHAT_ID = '795934610';

// Переключение полей в зависимости от типа заказа
document.getElementById('delivery_type').addEventListener('change', (e) => {
    const deliveryFields = document.getElementById('delivery_fields');
    const pickupFields = document.getElementById('pickup_fields');
    const branchPickup = document.getElementById('branch_pickup');

    if (e.target.value === 'Доставка') {
        deliveryFields.classList.remove('hidden');
        pickupFields.classList.add('hidden');
        branchPickup.disabled = true;
        document.getElementById('to_address').setAttribute('required', 'required');
        branchPickup.removeAttribute('required');
    } else if (e.target.value === 'Самовывоз') {
        deliveryFields.classList.add('hidden');
        pickupFields.classList.remove('hidden');
        branchPickup.disabled = false;
        document.getElementById('to_address').removeAttribute('required');
        branchPickup.setAttribute('required', 'required');
    }
});

// Изначально отключаем филиал для самовывоза, так как выбрана доставка
document.getElementById('branch_pickup').disabled = true;

// Добавление продукта
document.getElementById('addProductBtn').addEventListener('click', () => {
    const container = document.getElementById('products_container');
    const index = container.children.length;
    const row = document.createElement('div');
    row.className = 'flex justify-between gap-4 product-row bg-gray-50 p-4 rounded-md shadow-sm';
    row.innerHTML = `
                <div>
                    <label class="block text-sm font-medium text-gray-700">Название</label>
                    <input type="text" name="products[${index}][name]" value="" class="w-full p-2 border rounded-md focus-ring" aria-label="Название продукта">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Количество</label>
                    <div class="flex items-center border rounded-md">
                        <button type="button" class="p-2 text-blue-600 decrease-quantity" aria-label="Уменьшить количество">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="2" d="M18 13H6"></path></svg>
                        </button>
                        <input type="number" name="products[${index}][quantity]" value="1" min="1" class="w-full p-2 border-none focus-ring text-center" aria-label="Количество">
                        <button type="button" class="p-2 text-blue-600 increase-quantity" aria-label="Увеличить количество">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="2" d="M18 13h-5m0 0H6m7 0V6m0 7v5"></path></svg>
                        </button>
                    </div>
                </div>
                <div class="sm:col-span-3">
                    <label class="block text-sm font-medium text-gray-700">Описание</label>
                    <input type="text" name="products[${index}][description]" placeholder="Описание" class="w-full p-2 border rounded-md focus-ring" aria-label="Описание продукта">
                </div>
                <div class="items-end justify-center">
                    <label class="block text-sm font-medium text-red-500">Удалить</label>
                    <button type="button "class="flex alig px-4 py-2 border border-red-500 text-red-500 rounded-md hover:bg-red-50 focus-ring transition duration-150 ease-in-out">
                                    <svg class="w-5 h-5" fill="none"
                                        viewBox="0 0 24 24"><path
                                            stroke="currentColor"
                                            stroke-width="2"
                                            d="M6 6l12 12m0-12L6 18"></path></svg>
                    </button>
                </div>
            `;
    container.appendChild(row);
    bindProductEvents(row);
});

// Привязка событий к продуктам
// Привязка событий к продуктам
function bindProductEvents(row) {
   
    row.querySelector('.increase-quantity').addEventListener('click', () => {
        const input = row.querySelector('input[type="number"]');
        input.value = parseFloat(input.value) + 1;
    });
    row.querySelector('.decrease-quantity').addEventListener('click', () => {
        const input = row.querySelector('input[type="number"]');
        if (parseFloat(input.value) > 0) {
            input.value = parseFloat(input.value) - 1;
        }
    });
}

// Инициализация существующих продуктов
document.querySelectorAll('.product-row').forEach(bindProductEvents);

// Выбор метода оплаты
document.querySelectorAll('.payment-type').forEach(type => {
    type.addEventListener('click', () => {
        document.querySelectorAll('.payment-type').forEach(t => t.classList.remove('active'));
        type.classList.add('active');
        const input = type.nextElementSibling;
        input.checked = true;
    });
});

// Отправка формы
document.getElementById('orderForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = {
        client_name: formData.get('client_name') || 'Не указано',
        phone_number_1: formData.get('phone_number_1') || 'Не указано',
        delivery_type: formData.get('delivery_type'),
        payment_type: formData.get('payment_type'),
        description: formData.get('description') || '',
        products: [],
        delivery_details: {}
    };

    if (data.delivery_type === 'Доставка') {
        data.delivery_details = {
            to_address: formData.get('to_address') || '',
            accommodation: formData.get('accommodation') || '',
            apartment: formData.get('apartment') || '',
            floor: formData.get('floor') || '',
            building: formData.get('building') || '',
            delivery_date: formData.get('delivery_date') || '',
            delivery_time: formData.get('delivery_time') || ''
        };
    } else {
        data.delivery_details = {
            branch: formData.get('branch') || ''
        };
    }

    const productRows = document.querySelectorAll('.product-row');
    productRows.forEach((row, index) => {
        const product = {
            name: formData.get(`products[${index}][name]`) || '',
            quantity: formData.get(`products[${index}][quantity]`) || '0',
            description: formData.get(`products[${index}][description]`) || ''
        };
        data.products.push(product);
    });

    let message = `*Новый заказ*\n\n`;
    message += `*Имя клиента*: ${data.client_name}\n`;
    message += `*Телефон*: ${data.phone_number_1}\n`;
    message += `*Тип заказа*: ${data.delivery_type}\n`;

    if (data.delivery_type === 'Доставка') {
        message += `*Адрес доставки*:\n`;
        message += `  Адрес: ${data.delivery_details.to_address}\n`;
        if (data.delivery_details.accommodation) message += `  Дом: ${data.delivery_details.accommodation}\n`;
        if (data.delivery_details.apartment) message += `  Квартира: ${data.delivery_details.apartment}\n`;
        if (data.delivery_details.floor) message += `  Этаж: ${data.delivery_details.floor}\n`;
        if (data.delivery_details.building) message += `  Подъезд: ${data.delivery_details.building}\n`;
        if (data.delivery_details.delivery_date) message += `  Дата доставки: ${data.delivery_details.delivery_date}\n`;
        if (data.delivery_details.delivery_time) message += `  Время доставки: ${data.delivery_details.delivery_time}\n`;
    } else {
        message += `*Филиал для самовывоза*: ${data.delivery_details.branch}\n`;
    }

    message += `\n*Продукты*:\n`;
    data.products.forEach((product, index) => {
        message += `${index + 1}. ${product.name} - Количество: ${product.quantity}`;
        if (product.description) message += ` (Описание: ${product.description})`;
        message += `\n`;
    });

    if (data.description) {
        message += `\n*Комментарий*: ${data.description}\n`;
    }

    message += `\n*Метод оплаты*: ${data.payment_type}`;

    try {
        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                chat_id: CHAT_ID,
                text: message,
                parse_mode: 'Markdown'
            })
        });

        const result = await response.json();
        if (result.ok) {
            alert('Заказ успешно отправлен в Telegram!');
        } else {
            alert('Ошибка при отправке заказа: ' + result.description);
        }
    } catch (error) {
        alert('Ошибка при отправке заказа: ' + error.message);
    }
});
            
        </script>
    </body>
</html>